<!DOCTYPE html><html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Reset Password</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height:100vh; background:#f0f2f5; }
  .card { background:white;padding:2rem;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);max-width:400px;width:90%; }
  input, button { width:100%;padding:10px;margin-top:10px;font-size:16px;border-radius:4px;border:1px solid #ccc; }
  button { background:#2563eb;color:white;border:none;cursor:pointer; }
  .message { margin-top:10px;font-weight:bold; }
</style>
</head>
<body>
<div class="card">
  <h2>Reset Your Password</h2>
  <input type="password" id="password" placeholder="New password (min 6 chars)">
  <button onclick="resetPassword()">Update Password</button>
  <div class="message" id="message"></div>
</div>

<script>
  const supabase = supabase.createClient(
    'https://YOUR_PROJECT.supabase.co',
    'PUBLIC_ANON_KEY'
  );

  const params = new URLSearchParams(window.location.hash.substring(1));
  const access_token = params.get('access_token');
  const refresh_token = params.get('refresh_token');

  if (!access_token || !refresh_token) {
    document.getElementById('message').textContent = "❌ Invalid or missing token.";
  }

  async function resetPassword(){
    const msg = document.getElementById('message');
    msg.textContent = '';

    const pwd = document.getElementById('password').value;
    if (!pwd || pwd.length < 6) {
      msg.textContent = "❌ Password must be at least 6 characters.";
      return;
    }

    // Set the session with the tokens
    const { error: sessionError } = await supabase.auth.setSession({ access_token, refresh_token });
    if (sessionError) {
      msg.textContent = "❌ Session error: " + sessionError.message;
      return;
    }

    // Update the password
    const { error } = await supabase.auth.updateUser({ password: pwd });
    if (error) msg.textContent = "❌ " + error.message;
    else msg.textContent = "✅ Password updated successfully!";
  }
</script>
</body></html>
